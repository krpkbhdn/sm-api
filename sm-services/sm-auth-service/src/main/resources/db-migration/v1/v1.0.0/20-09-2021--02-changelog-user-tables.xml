<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <changeSet id="20-09-2021--02-changelog--01-create-table-sm_user" author="Bohdan Krupko">
        <createTable tableName="sm_user">
            <column name="id" type="integer8" defaultOnNull="false"/>
            <column name="username" type="varchar(255)" defaultOnNull="false"/>
            <column name="password" type="varchar(255)" defaultOnNull="false"/>
            <column name="account_non_expired" type="boolean" defaultValueBoolean="true"/>
            <column name="account_non_locked" type="boolean" defaultValueBoolean="true"/>
            <column name="credentials_non_expired" type="boolean" defaultValueBoolean="true"/>
            <column name="enabled" type="boolean" defaultValueBoolean="true"/>
        </createTable>
        <rollback>
            <dropTable tableName="sm_user"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--02-add-primary-key-for-table-sm_user" author="Bohdan Krupko">
        <addPrimaryKey tableName="sm_user" columnNames="id" constraintName="pk_sm_user"/>
        <rollback>
            <dropPrimaryKey tableName="sm_user" constraintName="pk_sm_user"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--03-create-table-role" author="Bohdan Krupko">
        <createTable tableName="role">
            <column name="id" type="integer" defaultOnNull="false"/>
            <column name="name" type="varchar(255)" defaultOnNull="false"/>
        </createTable>
        <rollback>
            <dropTable tableName="role"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--04-add-primary-key-for-table-role" author="Bohdan Krupko">
        <addPrimaryKey tableName="role" columnNames="id" constraintName="pk_role"/>
        <rollback>
            <dropPrimaryKey tableName="role" constraintName="pk_role"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--05-add-unique-constraint-for-table-role" author="Bohdan Krupko">
        <addUniqueConstraint tableName="role" columnNames="name" constraintName="uq_role_name"/>
        <rollback>
            <dropUniqueConstraint tableName="role" constraintName="uq_role_name"/>
        </rollback>
    </changeSet>
    
    <changeSet id="20-09-2021--02-changelog--06-create-table-permission" author="Bohdan Krupko">
        <createTable tableName="permission">
            <column name="id" type="integer" defaultOnNull="false"/>
            <column name="name" type="varchar(255)" defaultOnNull="false"/>
        </createTable>
        <rollback>
            <dropTable tableName="permission"/>
        </rollback>
    </changeSet>
    
    <changeSet id="20-09-2021--02-changelog--07-add-primary-key-for-table-permission" author="Bohdan Krupko">
        <addPrimaryKey tableName="permission" columnNames="id" constraintName="pk_permission"/>
        <rollback>
            <dropPrimaryKey tableName="permission" constraintName="pk_permission"/>
        </rollback>
    </changeSet>
    
    <changeSet id="20-09-2021--02-changelog--08-add-unique-constraint-for-table-permission" author="Bohdan Krupko">
        <addUniqueConstraint tableName="permission" columnNames="name" constraintName="uq_permission_name"/>
        <rollback>
            <dropUniqueConstraint tableName="permission" constraintName="uq_permission_name"/>
        </rollback>
    </changeSet>
    
    <changeSet id="20-09-2021--02-changelog--09-create-table-user_role" author="Bohdan Krupko">
        <createTable tableName="user_role">
            <column name="user_id" type="integer8" defaultOnNull="false"/>
            <column name="role_id" type="integer" defaultOnNull="false"/>
        </createTable>
        <rollback>
            <dropTable tableName="user_role"/>
        </rollback>
    </changeSet>
    
    <changeSet id="20-09-2021--02-changelog--10-add-primary-key-for-table-user_role" author="Bohdan Krupko">
        <addPrimaryKey tableName="user_role" columnNames="user_id,role_id" constraintName="pk_user_role"/>
        <rollback>
            <dropPrimaryKey tableName="user_role" constraintName="pk_user_role"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--11-add-foreign-key-for-table-user_role-sm_user" author="Bohdan Krupko">
        <addForeignKeyConstraint baseTableName="user_role"
                                 baseColumnNames="user_id"
                                 referencedTableName="sm_user"
                                 referencedColumnNames="id"
                                 constraintName="fk1_user_role_sm_user"/>
        <addForeignKeyConstraint baseTableName="user_role"
                                 baseColumnNames="role_id"
                                 referencedTableName="role"
                                 referencedColumnNames="id"
                                 constraintName="fk2_user_role_role"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="user_role" constraintName="fk1_user_role_sm_user"/>
            <dropForeignKeyConstraint baseTableName="user_role" constraintName="fk2_user_role_role"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--12-create-table-role_permission" author="Bohdan Krupko">
        <createTable tableName="role_permission">
            <column name="role_id" type="integer" defaultOnNull="false"/>
            <column name="permission_id" type="integer" defaultOnNull="false"/>
        </createTable>
        <rollback>
            <dropTable tableName="role_permission"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--13-add-primary-key-for-table-role_permission" author="Bohdan Krupko">
        <addPrimaryKey tableName="role_permission" columnNames="role_id,permission_id" constraintName="pk_role_permission"/>
        <rollback>
            <dropPrimaryKey tableName="role_permission" constraintName="pk_role_permission"/>
        </rollback>
    </changeSet>

    <changeSet id="20-09-2021--02-changelog--14-add-foreign-key-for-table-role_permission-permission" author="Bohdan Krupko">
        <addForeignKeyConstraint baseTableName="role_permission"
                                 baseColumnNames="role_id"
                                 referencedTableName="role"
                                 referencedColumnNames="id"
                                 constraintName="fk1_role_permission_role"/>
        <addForeignKeyConstraint baseTableName="role_permission"
                                 baseColumnNames="permission_id"
                                 referencedTableName="permission"
                                 referencedColumnNames="id"
                                 constraintName="fk2_role_permission_permission"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="role_permission" constraintName="fk1_role_permission_role"/>
            <dropForeignKeyConstraint baseTableName="role_permission" constraintName="fk2_role_permission_permission"/>
        </rollback>
    </changeSet>


</databaseChangeLog>
